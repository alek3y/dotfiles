#  _ ___             ___ _
# |_|_  |___ ___ ___|  _|_|___
# | |_  |  _| . |   |  _| | . |
# |_|___|___|___|_|_|_| |_|_  |
#                         |___|
#
# This is ale's ~/.config/i3/config

##
# Wallpaper
#

exec_always --no-startup-id feh --bg-fill ~/Pictures/wallpaper.png

##
# Bindings
#

# Super (Win) key
set $mod Mod4

# Close a window
bindsym $mod+q kill

# Terminal
bindsym $mod+Return exec --no-startup-id i3-sensible-terminal

# Open empty window
bindsym $mod+Shift+q exec --no-startup-id i3-msg open

# Set the key to move floating windows along with the mouse
floating_modifier $mod

# Focus navigation
bindsym $mod+Left focus left
bindsym $mod+Down focus down
bindsym $mod+Up focus up
bindsym $mod+Right focus right

# Move focused window
bindsym $mod+Shift+Left move left
bindsym $mod+Shift+Down move down
bindsym $mod+Shift+Up move up
bindsym $mod+Shift+Right move right

# Create a new container and toggle the split direction
bindsym $mod+x split toggle
#bindsym $mod+h split h
#bindsym $mod+v split v

# Focus the parent container
bindsym $mod+a focus parent

# Change container layout
# - split: Tiling layout (default)
# - stacking: Focused window with vertical stacked list
# - tabbed: Focused window with horizontal stacked list
bindsym $mod+e layout toggle split
bindsym $mod+s layout stacking
bindsym $mod+w layout tabbed

# Switch between floating and tiling for the focused window
bindsym $mod+f floating toggle

# Toggle focus between tiling and floating windows
bindsym $mod+c focus mode_toggle

# Fullscreen toggle
bindsym $mod+t fullscreen toggle

# Reload config file
#bindsym $mod+Shift+c reload

# Reload i3wm
bindsym $mod+Shift+r restart

##
# Workspaces
#

# First monitor
set $ws1 "1: Browser"
set $ws2 "2: Terminal"
set $ws3 "3: Coding"
set $ws4 "4: Other"
workspace $ws1 output HDMI-A-0
workspace $ws2 output HDMI-A-0
workspace $ws3 output HDMI-A-0
workspace $ws4 output HDMI-A-0

# Second monitor
set $ws5 "5: Browser"
set $ws6 "6: Terminal"
set $ws7 "7: Coding"
set $ws8 "8: Other"
workspace $ws5 output DisplayPort-0
workspace $ws6 output DisplayPort-0
workspace $ws7 output DisplayPort-0
workspace $ws8 output DisplayPort-0

# Switch to workspace
bindsym $mod+1 workspace $ws5, workspace $ws1
bindsym $mod+2 workspace $ws6, workspace $ws2
bindsym $mod+3 workspace $ws7, workspace $ws3
bindsym $mod+4 workspace $ws8, workspace $ws4

# Move window to workspace
bindsym $mod+Shift+1 move container to workspace $ws1
bindsym $mod+Shift+2 move container to workspace $ws2
bindsym $mod+Shift+3 move container to workspace $ws3
bindsym $mod+Shift+4 move container to workspace $ws4

##
# Displays
#

# Set the first monitor as primary and change positions
exec --no-startup-id xrandr --output HDMI-A-0 --primary --left-of DisplayPort-0

# Start the compositor to prevent tearing
exec --no-startup-id compton --config ~/.config/compton.conf

##
# Window styles
#

# Set window border width in px
set $windowborder 8
default_border normal $windowborder

# Font for window titles
set $font DejaVu Sans Mono
set $fontsize 11
font pango:$font $fontsize
title_align center

# Color for focused and unfocused window titles
set $activetext #dadada
set $inactivetext #8f8f8f

# Focused and unfocused window border color
set $activeborder #2f2f2f
set $inactiveborder #404040

# Color for the indicator of the split direction
set $splitdirection #292929

# Background and text color for urgent windows
set $urgentborder #b74C4a
set $urgenttext #803534

# Set the colors
client.focused           $activeborder   $activeborder   $activetext   $splitdirection $activeborder
client.focused_inactive  $inactiveborder $inactiveborder $inactivetext $inactiveborder $inactiveborder
client.unfocused         $inactiveborder $inactiveborder $inactivetext $inactiveborder $inactiveborder
client.urgent            $urgentborder   $urgentborder   $urgenttext   $urgentborder   $urgentborder

##
# Application launcher
#

# DMenu colors
set $dmenuactivebg #b74c4a

# DMenu binding
#bindsym $mod+d exec --no-startup-id "dmenu_run -nf '$activetext' -nb '$activeborder' -sb '$dmenuactivebg' -sf '$activetext' -fn '$font-$fontsize'"

# Rofi colors
set $rofiwidth 35
set $rofiheight 10
set $rofidpi -1
set $rofihistorysize 4
set $rofifontsize 13
set $rofitheme ~/.config/rofi/theme.rasi

# Rofi binding
bindsym $mod+d exec --no-startup-id "rofi -show run -width $rofiwidth -lines $rofiheight -dpi $rofidpi -max-history-size $rofihistorysize -display-run '> ' -display-drun '> ' -scroll-method 1 -font '$font $rofifontsize' -theme '$rofitheme'"

##
# Lockscreen setup
#

# Timeout and blank time
set $lockminutes 15
set $blankseconds 1200

# Lockscreen script path
set $lockscreen "~/.config/i3/lockscreen.sh"

# Set the screen blank time
exec --no-startup-id xset s $blankseconds $blankseconds

# Start the lock daemon
set $checker "~/.config/i3/checkbeforelock.sh"
exec --no-startup-id xautolock -secure -detectsleep -time $lockminutes -locker $checker -nowlocker $checker

##
# Resize window
#

mode "Resize" {
	bindsym Right resize grow width 100 px or 10 ppt
	bindsym Left resize shrink width 100 px or 10 ppt
	bindsym Up resize shrink height 100 px or 10 ppt
	bindsym Down resize grow height 100 px or 10 ppt

	bindsym Escape mode "default"
	bindsym $mod+r mode "default"
}

bindsym $mod+r mode "Resize"

##
# Power management
#

mode "Power" {
	bindsym l exec --no-startup-id $lockscreen, mode "default"
	bindsym e exec --no-startup-id i3-nagbar -t warning -m "Do you really want to logout?" -B "Yup!" "i3-msg exit", mode "default"
	bindsym s exec --no-startup-id $lockscreen && systemctl suspend, mode "default"
	bindsym r exec --no-startup-id i3-nagbar -t warning -m "Do you really want to reboot?" -B "Yup!" "systemctl reboot", mode "default"
	bindsym p exec --no-startup-id i3-nagbar -t warning -m "Do you really want to poweroff?" -B "Yup!" "systemctl poweroff", mode "default"

	bindsym Escape mode "default"
	bindsym $mod+Pause mode "default"
}

bindsym $mod+Pause mode "Power"

# Fast shortcut to lock the screen
bindsym $mod+l exec --no-startup-id bash -c $lockscreen

##
# Workspace bar
#

# Color of the bar
set $barbackground #292929
set $separator #383838

bar {

	# Use i3blocks for the status bar
	status_command i3blocks -c ~/.config/i3blocks/config

	# Remove the number prefixes that keep the workspaces ordered
	strip_workspace_numbers yes

	# Set the monitor for the system tray
	tray_output primary

	separator_symbol "┃"
	position top
	font pango:$font $fontsize

	colors {
		background $barbackground
		separator $separator
		statusline $inactivetext
		
		focused_workspace $barbackground $barbackground $activetext
		active_workspace $barbackground $barbackground $activetext
		inactive_workspace $barbackground $barbackground $inactivetext
		urgent_workspace $urgentborder $urgentborder $urgenttext
		binding_mode $urgentborder $urgentborder $activetext
	}
}

##
# Window rules
#

for_window [class="Pavucontrol"] floating enable

##
# Other stuff
#

# Set mouse acceleration
exec_always --no-startup-id "~/.config/i3/setmouseaccel.sh -0.3"

# Focus on mouse hover
focus_follows_mouse no

# Move the mouse to window center when switching display
mouse_warping none

# Focus the window of the opposide side when trying to focus in
# a direction with no windows left
focus_wrapping no

# Return to the old workspace after going in another one
# by pressing the same key combination
workspace_auto_back_and_forth yes

# Set the minimum and maximum size for floating window
floating_minimum_size 384 x 216
floating_maximum_size 1600 x 900
